<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Cup - SensiCup</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                min-height: 100vh;
                padding-top: 80px;
                position: relative;
            }

            /* Subtle animated background */
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(circle at 20% 80%, rgba(120, 200, 255, 0.1) 0%, transparent 50%),
                           radial-gradient(circle at 80% 20%, rgba(180, 220, 255, 0.1) 0%, transparent 50%),
                           radial-gradient(circle at 40% 40%, rgba(100, 180, 255, 0.05) 0%, transparent 50%);
                animation: backgroundFloat 20s ease-in-out infinite;
                z-index: -1;
            }

            @keyframes backgroundFloat {
                0%, 100% { transform: translateY(0) scale(1); }
                50% { transform: translateY(-20px) scale(1.02); }
            }
            
            /* Header */
            .header {
                position: fixed;
                top: 0;
                width: 100%;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-bottom: 1px solid rgba(0, 0, 0, 0.05);
                padding: 1rem 2rem;
                z-index: 1000;
                box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            }
            
            .nav {
                display: flex;
                justify-content: space-between;
                align-items: center;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .logo {
                font-size: 1.8rem;
                font-weight: 700;
                color: #0f4c75;
                text-decoration: none;
                transition: all 0.3s ease;
            }
            
            .logo:hover {
                transform: scale(1.05);
            }
            
            .nav-links {
                display: flex;
                list-style: none;
                gap: 2rem;
            }
            
            .nav-links a {
                text-decoration: none;
                color: #333;
                font-weight: 500;
                padding: 0.8rem 1.5rem;
                border-radius: 25px;
                transition: all 0.3s ease;
                position: relative;
                display: block;
            }
            
            .nav-links a:hover,
            .nav-links a.active {
                background: #0f4c75;
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(15, 76, 117, 0.3);
            }
            
            /* Main Content */
            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 3rem 2rem;
                text-align: center;
            }
            
            .page-title {
                font-size: 3.5rem;
                margin-bottom: 3rem;
                color: #0f4c75;
                font-weight: 800;
                text-shadow: 0 4px 20px rgba(15, 76, 117, 0.1);
                animation: titleFadeIn 1s ease-out;
            }

            @keyframes titleFadeIn {
                0% { opacity: 0; transform: translateY(-30px); }
                100% { opacity: 1; transform: translateY(0); }
            }
            
            /* Modern Water Quality Status */
            .status-section {
                margin: 4rem 0;
                animation: statusSlideIn 1s ease-out 0.3s both;
            }

            @keyframes statusSlideIn {
                0% { opacity: 0; transform: translateY(30px); }
                100% { opacity: 1; transform: translateY(0); }
            }
            
            .status-text {
                font-size: 2.2rem;
                margin-bottom: 2rem;
                color: #333;
                font-weight: 600;
            }
            
            .status-meter {
                width: 400px;
                height: 20px;
                margin: 0 auto;
                position: relative;
                background: #e0e6ed;
                border-radius: 25px;
                overflow: hidden;
                box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
            }

            .status-fill {
                height: 100%;
                border-radius: 25px;
                background: #e0e6ed; /* Default gray background */
                width: 100%; /* Always full width for the background track */
                transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
            }

            /* New indicator bar that moves with the dot */
            .status-progress {
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                border-radius: 25px;
                width: 0%; /* Start at 0 for smooth animation */
                transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
                background: linear-gradient(90deg, 
                    #ff4757 0%,     /* Poor - Red */
                    #ff6b35 25%,    /* Fair - Orange */
                    #ffa502 50%,    /* Fair-Good - Yellow */
                    #2ed573 75%,    /* Good - Light Green */
                    #20bf6b 100%    /* Excellent - Green */
                );
            }

            .status-progress::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                animation: shimmerMeter 2s ease-in-out infinite;
            }

            @keyframes shimmerMeter {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }

            .status-labels {
                display: flex;
                justify-content: space-between;
                width: 400px;
                margin: 1rem auto 0;
                font-size: 0.9rem;
                color: #666;
                font-weight: 500;
            }

            .status-indicator {
                position: absolute;
                top: -8px;
                left: 0; /* Changed from right to left for easier calculation */
                width: 16px;
                height: 16px;
                background: white;
                border: 3px solid #0f4c75;
                border-radius: 50%;
                box-shadow: 0 4px 15px rgba(15, 76, 117, 0.3);
                animation: indicatorPulse 2s ease-in-out infinite;
                transition: left 1.2s cubic-bezier(0.4, 0, 0.2, 1);
                transform: translateX(-50%); /* Center the dot on its position */
            }

            @keyframes indicatorPulse {
                0%, 100% { transform: translateX(-50%) scale(1); }
                50% { transform: translateX(-50%) scale(1.2); }
            }
            
            /* Dashboard Grid */
            .dashboard-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 4rem;
                margin: 5rem 0;
                animation: dashboardFadeIn 1s ease-out 0.6s both;
            }

            @keyframes dashboardFadeIn {
                0% { opacity: 0; transform: translateY(40px); }
                100% { opacity: 1; transform: translateY(0); }
            }
            
            /* Camera Section */
            .camera-section {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border-radius: 25px;
                padding: 3rem;
                box-shadow: 0 20px 60px rgba(0,0,0,0.08);
                transition: all 0.4s ease;
                border: 1px solid rgba(15, 76, 117, 0.1);
                position: relative;
                overflow: hidden;
            }

            .camera-section::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(15, 76, 117, 0.02) 0%, transparent 100%);
                pointer-events: none;
            }
            
            .camera-section:hover {
                transform: translateY(-8px);
                box-shadow: 0 30px 80px rgba(0,0,0,0.12);
            }

            .section-title {
                font-size: 1.8rem;
                margin-bottom: 2rem;
                color: #0f4c75;
                font-weight: 700;
                position: relative;
                z-index: 1;
            }

            .section-title::after {
                content: '';
                position: absolute;
                bottom: -8px;
                left: 50%;
                transform: translateX(-50%);
                width: 40px;
                height: 3px;
                background: linear-gradient(90deg, #3282b8, #bbe1fa);
                border-radius: 2px;
            }
            
            .camera-feed {
                background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
                border-radius: 20px;
                width: 320px;
                height: 320px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #666;
                margin: 0 auto;
                border: 3px solid #e2e8f0;
                overflow: hidden;
                position: relative;
                box-shadow: inset 0 4px 20px rgba(0,0,0,0.05);
                transition: all 0.4s ease;
            }

            .camera-feed:hover {
                border-color: #3282b8;
                transform: scale(1.02);
            }
            
            .camera-feed img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                border-radius: 17px;
                transition: all 0.4s ease;
            }

            .camera-feed:hover img {
                transform: scale(1.05);
            }
            
            .camera-status {
                position: absolute;
                bottom: -35px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 0.95rem;
                color: #666;
                font-weight: 500;
                padding: 0.5rem 1rem;
                background: white;
                border-radius: 20px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
            }
            
            .camera-status.connected {
                color: #20bf6b;
                border: 2px solid #20bf6b;
            }
            
            .camera-status.error {
                color: #ff4757;
                border: 2px solid #ff4757;
            }

            .camera-status.connected::before {
                content: '●';
                margin-right: 0.5rem;
                animation: connectedPulse 2s infinite;
            }

            @keyframes connectedPulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }
            
            /* Sensor Cards */
            .sensors-section {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border-radius: 25px;
                padding: 3rem;
                box-shadow: 0 20px 60px rgba(0,0,0,0.08);
                transition: all 0.4s ease;
                border: 1px solid rgba(15, 76, 117, 0.1);
                position: relative;
                overflow: hidden;
            }

            .sensors-section::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, transparent 0%, rgba(15, 76, 117, 0.02) 100%);
                pointer-events: none;
            }

            .sensors-section:hover {
                transform: translateY(-8px);
                box-shadow: 0 30px 80px rgba(0,0,0,0.12);
            }
            
            .sensor-grid {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
                margin-top: 2rem;
            }
            
            .sensor-card {
                background: linear-gradient(135deg, #3282b8 0%, #0f4c75 100%);
                color: white;
                padding: 1.8rem 2.5rem;
                border-radius: 18px;
                text-align: left;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
                border: 2px solid transparent;
                box-shadow: 0 8px 25px rgba(50, 130, 184, 0.3);
            }

            .sensor-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
                transform: translateX(-100%);
                transition: transform 0.6s ease;
            }

            .sensor-card:hover::before {
                transform: translateX(100%);
            }

            .temperature-card {
                background: linear-gradient(135deg, #2ed573 0%, #20bf6b 100%);
                color: white;
                padding: 1.8rem 2.5rem;
                border-radius: 18px;
                text-align: left;
                font-weight: 600;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
                box-shadow: 0 8px 25px rgba(46, 213, 115, 0.3);
            }

            .cleanliness-card {
                background: linear-gradient(135deg, #5f27cd 0%, #341f97 100%);
                color: white;
                padding: 1.8rem 2.5rem;
                border-radius: 18px;
                text-align: left;
                font-weight: 600;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
                box-shadow: 0 8px 25px rgba(95, 39, 205, 0.3);
            }
            
            .sensor-card:hover,
            .temperature-card:hover,
            .cleanliness-card:hover {
                transform: translateY(-5px) scale(1.02);
                box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            }

            .sensor-card::after {
                content: '📊';
                position: absolute;
                right: 20px;
                top: 50%;
                transform: translateY(-50%);
                font-size: 1.5rem;
                opacity: 0.8;
                transition: all 0.3s ease;
            }

            .sensor-card:hover::after {
                transform: translateY(-50%) scale(1.2);
                opacity: 1;
            }

            .sensor-label {
                font-size: 1rem;
                opacity: 0.9;
                margin-bottom: 0.5rem;
                display: block;
            }

            .sensor-value {
                font-size: 1.4rem;
                font-weight: 700;
                display: block;
            }
            
            /* Modal Styles */
            .modal {
                display: none;
                position: fixed;
                z-index: 2000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.6);
                backdrop-filter: blur(5px);
                animation: modalFadeIn 0.3s ease;
            }
            
            @keyframes modalFadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            .modal-content {
                background: white;
                margin: 3% auto;
                padding: 0;
                border-radius: 25px;
                width: 90%;
                max-width: 900px;
                max-height: 85vh;
                overflow-y: auto;
                animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 50px 100px rgba(0,0,0,0.3);
            }
            
            @keyframes modalSlideIn {
                from { transform: translateY(-50px) scale(0.95); opacity: 0; }
                to { transform: translateY(0) scale(1); opacity: 1; }
            }
            
            .modal-header {
                background: linear-gradient(135deg, #3282b8 0%, #0f4c75 100%);
                color: white;
                padding: 2.5rem;
                border-radius: 25px 25px 0 0;
                position: relative;
            }
            
            .modal-title {
                font-size: 2.2rem;
                margin: 0;
                font-weight: 700;
            }
            
            .modal-body {
                padding: 3rem;
                line-height: 1.8;
            }
            
            .modal-body h3 {
                color: #0f4c75;
                margin-bottom: 1.5rem;
                font-size: 1.3rem;
                font-weight: 600;
            }
            
            .modal-body p {
                color: #555;
                margin-bottom: 2rem;
                font-size: 1.1rem;
            }
            
            .info-table {
                width: 100%;
                border-collapse: collapse;
                margin: 2rem 0;
                background: white;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            }
            
            .info-table th,
            .info-table td {
                padding: 1.5rem;
                text-align: left;
                border-bottom: 1px solid #f1f3f5;
            }
            
            .info-table th {
                background: linear-gradient(135deg, #0f4c75 0%, #3282b8 100%);
                color: white;
                font-weight: 600;
                font-size: 1.1rem;
            }
            
            .info-table tr:last-child td {
                border-bottom: none;
            }

            .info-table tr:hover {
                background: #f8fafc;
            }
            
            .close {
                position: absolute;
                right: 25px;
                top: 25px;
                color: white;
                font-size: 2rem;
                font-weight: bold;
                cursor: pointer;
                width: 45px;
                height: 45px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                background: rgba(255,255,255,0.2);
                transition: all 0.3s ease;
                border: 2px solid rgba(255,255,255,0.3);
            }
            
            .close:hover {
                background: rgba(255,255,255,0.3);
                transform: scale(1.1);
            }
            
            .citation {
                font-size: 0.95rem;
                color: #666;
                font-style: italic;
                margin-top: 2rem;
                padding: 1.5rem;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                border-radius: 15px;
                border-left: 4px solid #3282b8;
            }
            
            /* Footer */
            .footer {
                background: linear-gradient(135deg, #0f4c75 0%, #1e3d59 100%);
                color: white;
                text-align: center;
                padding: 3rem 2rem;
                margin-top: 6rem;
                position: relative;
            }

            .footer::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 2px;
                background: linear-gradient(90deg, #3282b8, #bbe1fa, #3282b8);
            }
            
            .footer-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 3rem;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .footer-section h4 {
                margin-bottom: 1.5rem;
                font-size: 1.3rem;
                color: #bbe1fa;
            }
            
            .footer-section h5 a {
                color: #ccc;
                text-decoration: none;
                font-weight: 400;
                transition: all 0.3s ease;
                display: inline-block;
                margin: 0.3rem 0;
            }
            
            .footer-section h5 a:hover {
                color: #bbe1fa;
                transform: translateX(5px);
            }
            
            /* Responsive Design */
            @media (max-width: 968px) {
                .dashboard-grid {
                    grid-template-columns: 1fr;
                    gap: 3rem;
                }
                
                .nav-links {
                    display: none;
                }
                
                .page-title {
                    font-size: 2.8rem;
                }
                
                .camera-feed {
                    width: 280px;
                    height: 280px;
                }

                .status-meter {
                    width: 320px;
                }

                .status-labels {
                    width: 320px;
                }
                
                .footer-grid {
                    grid-template-columns: 1fr;
                    gap: 2rem;
                }
                
                .modal-content {
                    width: 95%;
                    margin: 5% auto;
                }

                .modal-header {
                    padding: 2rem;
                }

                .modal-body {
                    padding: 2rem;
                }

                .modal-title {
                    font-size: 1.8rem;
                }
                
                .sensor-card::after {
                    display: none;
                }
            }

            /* Loading animation */
            .sensor-value.loading {
                background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
                background-size: 200% 100%;
                animation: loading 1.5s infinite;
                border-radius: 4px;
                color: transparent;
            }

            @keyframes loading {
                0% { background-position: 200% 0; }
                100% { background-position: -200% 0; }
            }
        </style>
    </head>

    <body>
        <!-- Header -->
        <header class="header">
            <nav class="nav">
                <a href="/" class="logo">SensiCup</a>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/your-cup" class="active">Your Cup</a></li>
                    <li><a href="/database">Database</a></li>
                    <li><a href="/contact">Contact Us</a></li>
                </ul>
            </nav>
        </header>

        <div class="container">
            <h1 class="page-title">Your SensiCup Dashboard</h1>
            
            <!-- Status Section -->
            <div class="status-section">
                <p class="status-text">Your water is <span id="water-status">Good</span></p>
                <div class="status-meter">
                    <div class="status-fill">
                        <div class="status-progress" id="status-progress"></div>
                        <div class="status-indicator" id="status-indicator"></div>
                    </div>
                </div>
                <div class="status-labels">
                    <span>Poor</span>
                    <span>Fair</span>
                    <span>Good</span>
                    <span>Excellent</span>
                </div>
            </div>
            
            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Camera Section -->
                <div class="camera-section">
                    <h2 class="section-title">Live Water Feed</h2>
                    <div class="camera-feed">
                        <img id="live-video" alt="Live Water Feed" />
                        <div id="camera-status" class="camera-status">Loading...</div>
                    </div>
                </div>

                <!-- Sensors Section -->
                <div class="sensors-section">
                    <h2 class="section-title">Water Analysis</h2>
                    <div class="sensor-grid">
                        <div class="sensor-card" onclick="openModal('ph-modal')">
                            <span class="sensor-label">pH Level</span>
                            <span class="sensor-value" id="ph-display">7.2</span>
                        </div>
                        <div class="sensor-card" onclick="openModal('tds-modal')">
                            <span class="sensor-label">TDS Level</span>
                            <span class="sensor-value" id="tds-display">245 ppm</span>
                        </div>
                        <div class="sensor-card" onclick="openModal('salinity-modal')">
                            <span class="sensor-label">Salinity Level</span>
                            <span class="sensor-value" id="salinity-display">0.02 ppt</span>
                        </div>
                        <div class="temperature-card">
                            <span class="sensor-label">Temperature</span>
                            <span class="sensor-value" id="temperature-display">25.0 °C</span>
                        </div>
                        <div class="cleanliness-card">
                            <span class="sensor-label">Cleanliness Score</span>
                            <span class="sensor-value" id="cleanliness-display">85/100</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- pH Modal -->
        <div id="ph-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close" onclick="closeModal('ph-modal')">&times;</span>
                    <h2 class="modal-title">What Does My Water's pH Level Mean?</h2>
                </div>
                <div class="modal-body">
                    <p>In simple terms, pH level in water indicates how acidic or basic (also called alkaline) the water is. It is a scale from 0 to 14, where 7 is neutral. A pH below 7 is acidic, and a pH above 7 is basic. While a pH of around 6.5 to 8.5 is often considered safe for drinking water, extreme pH levels can affect taste and potentially cause corrosion or scaling in pipes. Please check the chart given to see if the pH level is outside the range of safe drinking water for reference.</p>
                    
                    <table class="info-table">
                        <thead>
                            <tr>
                                <th>pH Range</th>
                                <th>Water Quality</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>0 - 6.4</td><td>Acidic (Poor)</td></tr>
                            <tr><td>6.5 - 8.5</td><td>Safe (Good)</td></tr>
                            <tr><td>8.6 - 14</td><td>Basic (Poor)</td></tr>
                        </tbody>
                    </table>
                    
                    <div class="citation">
                        Vanstone, Emma. "What Is the pH Scale?" Science Experiments for Kids, 16 Oct. 2023, www.science-sparks.com/what-is-the-ph-scale.
                    </div>
                </div>
            </div>
        </div>

        <!-- TDS Modal -->
        <div id="tds-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close" onclick="closeModal('tds-modal')">&times;</span>
                    <h2 class="modal-title">What Does My Water's TDS Level Mean?</h2>
                </div>
                <div class="modal-body">
                    <p>TDS (Total Dissolved Solids) will help measure your water quality by seeing the total amount of dissolved materials you can drink and materials you cannot such as salts, minerals, metals, etc. If your TDS level is under 300 milligrams per liter, then your water quality is excellent and most of the dissolved materials you have in your water is consumable! Please check the graph to see if the TDS level is your water is above 300 milligrams per liter for reference.</p>
                    
                    <table class="info-table">
                        <thead>
                            <tr>
                                <th>Level of TDS (milligrams per litre)</th>
                                <th>Rating</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Less than 300</td><td>Excellent</td></tr>
                            <tr><td>300 - 600</td><td>Good</td></tr>
                            <tr><td>600 - 900</td><td>Fair</td></tr>
                            <tr><td>900 - 1,200</td><td>Poor</td></tr>
                            <tr><td>Above 1,200</td><td>Unacceptable</td></tr>
                        </tbody>
                    </table>
                    
                    <div class="citation">
                        "Taste of Water with Different TDS Concentrations," https://cdn.who.int/media/docs/default-source/wash-documents/wash-chemicals/tds.pdf?sfvrsn=3e6d651e_4
                    </div>
                </div>
            </div>
        </div>

        <!-- Salinity Modal -->
        <div id="salinity-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close" onclick="closeModal('salinity-modal')">&times;</span>
                    <h2 class="modal-title">What Does My Water's Salinity Level Mean?</h2>
                </div>
                <div class="modal-body">
                    <p>Salinity levels in your water measure how much salt there is in your water. This will help you understand how much salinity can influence the drinking water you have as it strongly contributes to the content of the water you drink. If the salinity level in your water is 600 milligrams per liter or less, then your water quality is excellent with low salinity and you can drink it! For the higher salinity levels, the least likely it is healthy for you to drink it. Please check the chart given to see if the salinity level is higher than 600 milligrams per liter for reference.</p>
                    
                    <table class="info-table">
                        <thead>
                            <tr>
                                <th>Salinity (ppt)</th>
                                <th>Quality</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>0 - 0.5</td><td>Good</td></tr>
                            <tr><td>0.5 - 1.0</td><td>Fair</td></tr>
                            <tr><td>> 1.0</td><td>Poor</td></tr>
                        </tbody>
                    </table>
                    
                    <div class="citation">
                        Understanding Salinity. Department of Water. Government of Western Australia. wadow.clients.squiz.net/water-topics/water-quality/managing-water-quality/understanding-salinity
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4>SensiCup</h4>
                    <h5><a href="/">Home</a></h5>
                    <h5><a href="/contact">Contact Us</a></h5>
                </div>
                <div class="footer-section">
                    <h4>Information</h4>
                    <h5><a href="/your-cup">Your Cup</a></h5>
                    <h5><a href="/database">Database</a></h5>
                </div>
            </div>
        </footer>

        <!-- Socket.IO and JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
        <script>
            let socket;
            let imageRefreshInterval;
            let imageLoadAttempts = 0;
            const MAX_LOAD_ATTEMPTS = 5;
            const currentCupId = 'DEFAULT_CUP';
            
            // Auto-connect on page load
            window.addEventListener('load', function() {
                connectToWebSocket(currentCupId);
                loadInitialData();
                initializeCameraFeed();
            });
            
            function loadInitialData() {
                updateSensorDisplay({
                    ph: 7.2,
                    tds: 245,
                    temperature: 25.0,
                    salinity: 0.02,
                    cleanliness_score: 85
                });
            }
            
            function initializeCameraFeed() {
                const liveVideo = document.getElementById('live-video');
                const statusElement = document.getElementById('camera-status');
                
                function loadImage() {
                    const timestamp = new Date().getTime();
                    const imageUrl = `/static/sensicup.jpg?t=${timestamp}`;
                    
                    console.log('Attempting to load image:', imageUrl);
                    
                    const testImage = new Image();
                    
                    testImage.onload = function() {
                        console.log('Image loaded successfully');
                        liveVideo.src = imageUrl;
                        statusElement.textContent = 'Connected';
                        statusElement.className = 'camera-status connected';
                        imageLoadAttempts = 0;
                    };
                    
                    testImage.onerror = function() {
                        console.log('Image load failed, attempt:', imageLoadAttempts + 1);
                        imageLoadAttempts++;
                        
                        if (imageLoadAttempts >= MAX_LOAD_ATTEMPTS) {
                            console.log('Max load attempts reached, showing error');
                            liveVideo.style.display = 'none';
                            statusElement.textContent = 'Camera Not Available';
                            statusElement.className = 'camera-status error';
                            
                            const cameraFeed = document.querySelector('.camera-feed');
                            cameraFeed.innerHTML = '<div style="color: #666; font-size: 1.1rem;">Camera Not Available</div><div id="camera-status" class="camera-status error">Camera Not Available</div>';
                        } else {
                            statusElement.textContent = `Connecting... (${imageLoadAttempts}/${MAX_LOAD_ATTEMPTS})`;
                            statusElement.className = 'camera-status';
                        }
                    };
                    
                    testImage.src = imageUrl;
                }
                
                loadImage();
                imageRefreshInterval = setInterval(loadImage, 2000);
            }
            
            function connectToWebSocket(cupCode) {
                socket = io();
                
                socket.on('connect', function() {
                    console.log('Connected to server');
                    socket.emit('get_latest_data', {'cup_id': cupCode});
                });

                socket.on('sensor_update', function(data) {
                    console.log('Received sensor data:', data);
                    updateSensorDisplay(data);
                });
                
                socket.on('disconnect', function() {
                    console.log('Disconnected from server');
                });

                socket.on('connect_error', function(error) {
                    console.log('Connection error:', error);
                });
            }
            
            function updateSensorDisplay(data) {
                console.log('Updating display with:', data);
                
                // Update pH
                if (data.ph !== undefined && data.ph !== null) {
                    document.getElementById('ph-display').textContent = parseFloat(data.ph).toFixed(1);
                }
                
                // Update TDS
                if (data.tds !== undefined && data.tds !== null) {
                    document.getElementById('tds-display').textContent = Math.round(parseFloat(data.tds)) + ' ppm';
                }
                
                // Update Temperature
                if (data.temperature !== undefined && data.temperature !== null) {
                    document.getElementById('temperature-display').textContent = parseFloat(data.temperature).toFixed(1) + ' °C';
                }
                
                // Update Salinity
                if (data.salinity !== undefined && data.salinity !== null) {
                    let salinity = parseFloat(data.salinity);
                    if (salinity < 1) {
                        document.getElementById('salinity-display').textContent = (salinity).toFixed(2) + ' ppt';
                    } else {
                        document.getElementById('salinity-display').textContent = salinity.toFixed(2) + ' ppt';
                    }
                }
                
                // Update Cleanliness
                if (data.cleanliness_score !== undefined && data.cleanliness_score !== null) {
                    document.getElementById('cleanliness-display').textContent = Math.round(parseFloat(data.cleanliness_score)) + '/100';
                }
                
                // Update overall water status
                updateWaterStatus(data);
            }
            
            function updateWaterStatus(data) {
                let status = 'Good';
                let statusPercentage = 75; // Default position (Good = 75%)
                
                // Simple logic to determine overall water quality
                let issues = 0;
                
                // Check pH (6.5-8.5 is good)
                const ph = parseFloat(data.ph);
                if (ph < 6.5 || ph > 8.5) {
                    issues++;
                    console.log('pH issue detected:', ph);
                }
                
                // Check TDS (under 300 is excellent, under 600 is good)
                const tds = parseFloat(data.tds);
                if (tds > 600) {
                    issues++;
                    console.log('TDS issue detected:', tds);
                } else if (tds > 300) {
                    issues += 0.5;
                    console.log('TDS fair quality:', tds);
                }
                
                // Check cleanliness score
                const cleanliness = parseFloat(data.cleanliness_score);
                if (cleanliness < 60) {
                    issues++;
                    console.log('Cleanliness issue detected:', cleanliness);
                } else if (cleanliness < 80) {
                    issues += 0.5;
                    console.log('Cleanliness fair quality:', cleanliness);
                }
                
                // Determine status and percentage
                if (issues === 0) {
                    status = 'Excellent';
                    statusPercentage = 90;
                } else if (issues <= 1) {
                    status = 'Good';
                    statusPercentage = 75;
                } else if (issues <= 2) {
                    status = 'Fair';
                    statusPercentage = 50;
                } else {
                    status = 'Poor';
                    statusPercentage = 25;
                }
                
                // Update the display
                document.getElementById('water-status').textContent = status;
                const statusProgress = document.getElementById('status-progress');
                const statusIndicator = document.getElementById('status-indicator');
                
                // Calculate positions (accounting for the 400px width of the meter)
                const meterWidth = 400; // pixels
                const dotPosition = (statusPercentage / 100) * meterWidth;
                
                // Animate the progress bar
                statusProgress.style.width = statusPercentage + '%';
                
                // Move the indicator to match the progress
                statusIndicator.style.left = dotPosition + 'px';
                
                console.log('Overall status:', status, 'Issues:', issues, 'Percentage:', statusPercentage, 'Dot position:', dotPosition);
            }

            // Modal functions
            function openModal(modalId) {
                document.getElementById(modalId).style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }

            function closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
                document.body.style.overflow = 'auto'; // Re-enable scrolling
            }

            // Close modal when clicking outside of it
            window.onclick = function(event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }
                });
            }

            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal');
                    modals.forEach(modal => {
                        if (modal.style.display === 'block') {
                            modal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        }
                    });
                }
            });
            
            // Clean up intervals when page unloads
            window.addEventListener('beforeunload', function() {
                if (imageRefreshInterval) {
                    clearInterval(imageRefreshInterval);
                }
            });

            // Add loading animation to sensor values on page load
            window.addEventListener('load', function() {
                const sensorValues = document.querySelectorAll('.sensor-value');
                sensorValues.forEach(value => {
                    value.classList.add('loading');
                    setTimeout(() => {
                        value.classList.remove('loading');
                    }, 1500);
                });
                
                // Initialize the meter with animation after a delay
                setTimeout(() => {
                    updateWaterStatus({
                        ph: 7.2,
                        tds: 245,
                        temperature: 25.0,
                        salinity: 0.02,
                        cleanliness_score: 85
                    });
                }, 2000);
            });
        </script>
    </body>
</html>