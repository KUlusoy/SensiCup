<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Database - SensiCup</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                min-height: 100vh;
                padding-top: 80px;
                position: relative;
            }

            /* Subtle animated background */
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(circle at 20% 80%, rgba(120, 200, 255, 0.08) 0%, transparent 50%),
                           radial-gradient(circle at 80% 20%, rgba(180, 220, 255, 0.08) 0%, transparent 50%),
                           radial-gradient(circle at 40% 40%, rgba(100, 180, 255, 0.05) 0%, transparent 50%);
                animation: backgroundFloat 25s ease-in-out infinite;
                z-index: -1;
            }

            @keyframes backgroundFloat {
                0%, 100% { transform: translateY(0) scale(1) rotate(0deg); }
                33% { transform: translateY(-10px) scale(1.01) rotate(1deg); }
                66% { transform: translateY(10px) scale(0.99) rotate(-1deg); }
            }
            
            /* Header */
            .header {
                position: fixed;
                top: 0;
                width: 100%;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-bottom: 1px solid rgba(0, 0, 0, 0.05);
                padding: 1rem 2rem;
                z-index: 1000;
                box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            }
            
            .nav {
                display: flex;
                justify-content: space-between;
                align-items: center;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .logo {
                font-size: 1.8rem;
                font-weight: 700;
                color: #0f4c75;
                text-decoration: none;
                transition: all 0.3s ease;
            }
            
            .logo:hover {
                transform: scale(1.05);
            }
            
            .nav-links {
                display: flex;
                list-style: none;
                gap: 2rem;
            }
            
            .nav-links a {
                text-decoration: none;
                color: #333;
                font-weight: 500;
                padding: 0.8rem 1.5rem;
                border-radius: 25px;
                transition: all 0.3s ease;
                position: relative;
                display: block;
            }
            
            .nav-links a:hover,
            .nav-links a.active {
                background: #0f4c75;
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(15, 76, 117, 0.3);
            }
            
            /* Main Content */
            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 3rem 2rem;
            }

            .page-title {
                font-size: 3.5rem;
                margin-bottom: 4rem;
                color: #0f4c75;
                font-weight: 800;
                text-align: center;
                text-shadow: 0 4px 20px rgba(15, 76, 117, 0.1);
                animation: titleFadeIn 1s ease-out;
            }

            @keyframes titleFadeIn {
                0% { opacity: 0; transform: translateY(-30px); }
                100% { opacity: 1; transform: translateY(0); }
            }
            
            .upload-section {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border-radius: 25px;
                padding: 4rem;
                margin-bottom: 5rem;
                box-shadow: 0 20px 60px rgba(0,0,0,0.08);
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 4rem;
                align-items: flex-start;
                border: 1px solid rgba(15, 76, 117, 0.1);
                position: relative;
                overflow: hidden;
                animation: sectionSlideIn 1s ease-out 0.3s both;
            }

            @keyframes sectionSlideIn {
                0% { opacity: 0; transform: translateY(40px); }
                100% { opacity: 1; transform: translateY(0); }
            }

            .upload-section::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(15, 76, 117, 0.02) 0%, transparent 50%, rgba(15, 76, 117, 0.02) 100%);
                pointer-events: none;
            }
            
            .submit-section {
                padding-right: 2rem;
                border-right: 2px solid rgba(15, 76, 117, 0.1);
                position: relative;
                z-index: 1;
            }
            
            .upload-photos-section {
                padding-left: 2rem;
                position: relative;
                z-index: 1;
            }
            
            .section-title {
                font-size: 2.2rem;
                margin-bottom: 1.5rem;
                color: #0f4c75;
                font-weight: 700;
                position: relative;
            }

            .section-title::after {
                content: '';
                position: absolute;
                bottom: -8px;
                left: 0;
                width: 50px;
                height: 3px;
                background: linear-gradient(90deg, #3282b8, #bbe1fa);
                border-radius: 2px;
            }
            
            .upload-content h2 {
                font-size: 2.2rem;
                margin-bottom: 1.5rem;
                color: #0f4c75;
                font-weight: 700;
            }
            
            .upload-content p {
                color: #555;
                line-height: 1.8;
                margin-bottom: 2.5rem;
                font-size: 1.1rem;
            }
            
            .upload-form {
                margin-top: 1.5rem;
            }
            
            .upload-form input[type="text"] {
                width: 100%;
                padding: 18px 20px;
                border: 2px solid #e2e8f0;
                border-radius: 15px;
                font-size: 1.1rem;
                margin-bottom: 1.5rem;
                outline: none;
                transition: all 0.3s ease;
                background: white;
                font-family: inherit;
            }
            
            .upload-form input[type="text"]:focus {
                border-color: #3282b8;
                box-shadow: 0 0 0 3px rgba(50, 130, 184, 0.1);
                transform: translateY(-2px);
            }

            .upload-form input[type="text"]:hover {
                border-color: #cbd5e0;
            }
            
            .submit-btn {
                width: 100%;
                background: linear-gradient(135deg, #3282b8 0%, #0f4c75 100%);
                color: white;
                padding: 18px 24px;
                border: none;
                border-radius: 15px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.4s ease;
                position: relative;
                overflow: hidden;
                box-shadow: 0 8px 25px rgba(50, 130, 184, 0.3);
            }

            .submit-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.6s ease;
            }

            .submit-btn:hover::before {
                left: 100%;
            }
            
            .submit-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 15px 40px rgba(50, 130, 184, 0.4);
            }

            .submit-btn:active {
                transform: translateY(-1px);
            }
            
            .upload-area {
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                border: 2px dashed #cbd5e0;
                border-radius: 20px;
                padding: 3rem 2rem;
                text-align: center;
                cursor: pointer;
                transition: all 0.4s ease;
                min-height: 200px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                margin-top: 1.5rem;
                position: relative;
                overflow: hidden;
            }

            .upload-area::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(45deg, transparent, rgba(50, 130, 184, 0.05), transparent);
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .upload-area:hover::before {
                opacity: 1;
            }
            
            .upload-area:hover {
                background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
                border-color: #3282b8;
                transform: translateY(-5px);
                box-shadow: 0 15px 40px rgba(50, 130, 184, 0.15);
            }
            
            .upload-area.dragover {
                background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
                border-color: #3282b8;
                transform: scale(1.02);
                box-shadow: 0 20px 50px rgba(50, 130, 184, 0.2);
            }
            
            .upload-area i {
                font-size: 3rem;
                color: #3282b8;
                margin-bottom: 1.5rem;
                transition: all 0.3s ease;
            }

            .upload-area:hover i {
                transform: scale(1.1);
                color: #0f4c75;
            }
            
            .upload-area p {
                color: #555;
                margin: 0;
                font-size: 1.1rem;
                font-weight: 500;
            }
            
            .upload-area input[type="file"] {
                display: none;
            }
            
            .uploaded-files {
                margin-top: 1.5rem;
                text-align: left;
            }
            
            .file-item {
                background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
                padding: 0.8rem 1.5rem;
                border-radius: 12px;
                margin-bottom: 0.8rem;
                font-size: 0.95rem;
                color: #155724;
                border: 1px solid #c3e6cb;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .file-item::before {
                content: 'âœ“';
                position: absolute;
                left: 0.8rem;
                top: 50%;
                transform: translateY(-50%);
                color: #28a745;
                font-weight: bold;
                padding-right: 0.5rem;
            }

            .file-item {
                padding-left: 2.5rem;
            }

            .file-item:hover {
                transform: translateX(5px);
                box-shadow: 0 4px 15px rgba(40, 167, 69, 0.2);
            }
            
            /* Database Section */
            .database-section {
                margin-top: 6rem;
                animation: databaseFadeIn 1s ease-out 0.6s both;
            }

            @keyframes databaseFadeIn {
                0% { opacity: 0; transform: translateY(30px); }
                100% { opacity: 1; transform: translateY(0); }
            }
            
            .database-section h2 {
                font-size: 3rem;
                margin-bottom: 3rem;
                color: #0f4c75;
                font-weight: 800;
                text-align: center;
                position: relative;
            }

            .database-section h2::after {
                content: '';
                position: absolute;
                bottom: -15px;
                left: 50%;
                transform: translateX(-50%);
                width: 80px;
                height: 4px;
                background: linear-gradient(90deg, #3282b8, #bbe1fa);
                border-radius: 2px;
            }
            
            .database-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: 2.5rem;
            }
            
            .database-card {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border-radius: 20px;
                padding: 2.5rem;
                box-shadow: 0 15px 50px rgba(0,0,0,0.08);
                text-align: center;
                position: relative;
                cursor: pointer;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                border: 1px solid rgba(15, 76, 117, 0.1);
                overflow: hidden;
            }

            .database-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(50, 130, 184, 0.02) 0%, transparent 50%, rgba(50, 130, 184, 0.02) 100%);
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .database-card:hover::before {
                opacity: 1;
            }

            .database-card:hover {
                transform: translateY(-10px) scale(1.02);
                box-shadow: 0 25px 70px rgba(0,0,0,0.15);
                border-color: #3282b8;
            }
            
            .database-card-content {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                height: 100%;
                position: relative;
                z-index: 1;
            }

            .database-card-buttons {
                position: absolute;
                top: 1.5rem;
                right: 1.5rem;
                display: flex;
                gap: 0.8rem;
                z-index: 2;
            }
            
            .delete-btn, .download-btn {
                background: #ff4757;
                color: white;
                border: none;
                border-radius: 12px;
                width: 40px;
                height: 40px;
                cursor: pointer;
                font-size: 1.1rem;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
                text-decoration: none;
            }

            .download-btn {
                background: #3282b8;
                box-shadow: 0 4px 15px rgba(50, 130, 184, 0.3);
            }

            .delete-btn:hover { 
                background: #ff3838;
                transform: scale(1.1);
                box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
            }
            
            .download-btn:hover { 
                background: #0f4c75;
                transform: scale(1.1);
                box-shadow: 0 6px 20px rgba(50, 130, 184, 0.4);
            }

            .database-image-container {
                height: 220px;
                border-radius: 15px;
                margin-bottom: 1.5rem;
                overflow: hidden;
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
                border: 2px solid #e2e8f0;
                transition: all 0.3s ease;
            }

            .database-card:hover .database-image-container {
                transform: scale(1.05);
                border-color: #3282b8;
            }

            .database-image-container img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: all 0.4s ease;
            }

            .database-card:hover .database-image-container img {
                transform: scale(1.1);
            }

            .database-image-container .placeholder {
                color: #666;
                font-style: italic;
                font-size: 1.1rem;
            }
            
            .database-card h3 {
                margin-bottom: 1rem;
                color: #0f4c75;
                font-size: 1.4rem;
                font-weight: 700;
            }
            
            .database-card p {
                color: #555;
                font-size: 0.95rem;
                line-height: 1.6;
                margin-bottom: 0.8rem;
            }

            .database-card p strong {
                color: #3282b8;
                font-weight: 600;
            }

            /* Lightbox/Modal */
            .lightbox {
                display: none;
                position: fixed;
                z-index: 2000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0,0,0,0.9);
                backdrop-filter: blur(5px);
                justify-content: center;
                align-items: center;
                animation: lightboxFadeIn 0.3s ease;
            }

            @keyframes lightboxFadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            .lightbox-content {
                position: relative;
                max-width: 85%;
                max-height: 85%;
                display: flex;
                align-items: center;
                animation: lightboxSlideIn 0.4s ease;
            }

            @keyframes lightboxSlideIn {
                from { transform: scale(0.8); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }

            .lightbox-content img {
                max-width: 100%;
                max-height: 100%;
                border-radius: 15px;
                display: block;
                margin: auto;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            }

            .lightbox-prev, .lightbox-next {
                cursor: pointer;
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                color: white;
                font-size: 2.5rem;
                font-weight: bold;
                transition: all 0.3s ease;
                user-select: none;
                padding: 1rem;
                background-color: rgba(0,0,0,0.6);
                border-radius: 50%;
                width: 60px;
                height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
                border: 2px solid rgba(255,255,255,0.2);
            }

            .lightbox-close {
                cursor: pointer;
                position: absolute;
                top: 2rem;
                right: 2rem;
                color: white;
                font-weight: bold;
                transition: all 0.3s ease;
                user-select: none;
                background-color: rgba(0,0,0,0.6);
                border: 2px solid rgba(255,255,255,0.3);
                font-size: 1.5rem;
                padding: 0.8rem;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            }

            .lightbox-prev { left: 2rem; }
            .lightbox-next { right: 2rem; }

            .lightbox-close:hover,
            .lightbox-prev:hover,
            .lightbox-next:hover {
                background-color: rgba(255,255,255,0.2);
                transform: scale(1.1);
                border-color: rgba(255,255,255,0.5);
            }

            /* Footer */
            .footer {
                background: linear-gradient(135deg, #0f4c75 0%, #1e3d59 100%);
                color: white;
                text-align: center;
                padding: 3rem 2rem;
                margin-top: 6rem;
                position: relative;
            }

            .footer::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 2px;
                background: linear-gradient(90deg, #3282b8, #bbe1fa, #3282b8);
            }
            
            .footer-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 3rem;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .footer-section h4 {
                margin-bottom: 1.5rem;
                font-size: 1.3rem;
                color: #bbe1fa;
            }
            
            .footer-section h5 a {
                color: #ccc;
                text-decoration: none;
                font-weight: 400;
                transition: all 0.3s ease;
                display: inline-block;
                margin: 0.3rem 0;
            }
            
            .footer-section h5 a:hover {
                color: #bbe1fa;
                transform: translateX(5px);
            }
            
            /* Responsive Design */
            @media (max-width: 968px) {
                .upload-section {
                    grid-template-columns: 1fr;
                    gap: 3rem;
                    padding: 3rem 2rem;
                }
                
                .submit-section {
                    border-right: none;
                    border-bottom: 2px solid rgba(15, 76, 117, 0.1);
                    padding-right: 0;
                    padding-bottom: 2rem;
                }
                
                .upload-photos-section {
                    padding-left: 0;
                    padding-top: 2rem;
                }
                
                .nav-links {
                    display: none;
                }
                
                .database-grid {
                    grid-template-columns: 1fr;
                }
                
                .footer-grid {
                    grid-template-columns: 1fr;
                    gap: 2rem;
                }
                
                .lightbox-prev, .lightbox-next {
                    font-size: 2rem;
                    padding: 0.8rem;
                    width: 50px;
                    height: 50px;
                }
                
                .lightbox-close {
                    top: 1rem;
                    right: 1rem;
                    width: 45px;
                    height: 45px;
                }

                .page-title {
                    font-size: 2.8rem;
                }

                .section-title {
                    font-size: 1.8rem;
                }

                .database-section h2 {
                    font-size: 2.4rem;
                }
            }

            /* No databases message */
            .no-databases {
                grid-column: 1 / -1;
                text-align: center;
                color: #666;
                font-style: italic;
                font-size: 1.2rem;
                padding: 4rem 2rem;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                border-radius: 20px;
                border: 2px dashed #cbd5e0;
            }

            .no-databases i {
                font-size: 3rem;
                color: #cbd5e0;
                margin-bottom: 1rem;
                display: block;
            }
        </style>
    </head>
    <body>
        <!-- Header -->
        <header class="header">
            <nav class="nav">
                <a href="/" class="logo">SensiCup</a>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/your-cup">Your Cup</a></li>
                    <li><a href="/database" class="active">Database</a></li>
                    <li><a href="/contact">Contact Us</a></li>
                </ul>
            </nav>
        </header>

        <div class="container">
            <h1 class="page-title">Water Quality Database</h1>
            
            <div class="upload-section">
                <div class="submit-section">
                    <h2>Submit Database Information</h2>
                    <p>Currently, datasets that label particles in the water to monitor water quality are scarce. By adding your photos, you can contribute to crowdsourcing and creating collections of photos for others to download, which is helpful to make machine learning models better or the science community in general.</p>
                    
                    <form class="upload-form" action="/submit-photo" method="POST" enctype="multipart/form-data" id="databaseForm">
                        <input type="text" placeholder="Database name" name="database_name" required>
                        <input type="text" placeholder="Add a description" name="description" required>
                        <button type="submit" class="submit-btn">Create Database</button>
                    </form>
                </div>
                
                <div class="upload-photos-section">
                    <h3 class="section-title">Upload Photos</h3>
                    <p style="color: #555; margin-bottom: 1.5rem; font-size: 1.05rem;">Select or drag photos to upload to your database</p>
                    
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <input type="file" id="fileInput" name="photos" multiple accept="image/*" form="databaseForm">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                        <p>Click or drag photos here</p>
                        <div class="uploaded-files" id="uploadedFiles"></div>
                    </div>
                </div>
            </div>
            
            <div class="database-section">
                <h2>Your Databases</h2>
                <div class="database-grid" id="databaseGrid">
                    <!-- Databases will be loaded from backend -->
                    {% if databases %}
                        {% for database in databases %}
                        <div class="database-card" data-id="{{ database.id }}">
                            <div class="database-card-buttons">
                                <form action="/delete-database" method="POST" style="display: inline;" onclick="event.stopPropagation()">
                                    <input type="hidden" name="database_id" value="{{ database.id }}">
                                    <button type="submit" class="delete-btn" title="Delete database">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </form>
                                <a href="/download_database/{{ database.id }}" class="download-btn" title="Download database" onclick="event.stopPropagation()">
                                    <i class="fa-solid fa-download"></i>
                                </a>
                            </div>
                            <div class="database-card-content">
                                <div class="database-image-container">
                                    {% if database.first_photo_path %}
                                        <img src="{{ url_for('display_photo', filename=database.first_photo_path) }}" alt="Cover image for {{ database.name }}">
                                    {% else %}
                                        <p class="placeholder">No photos uploaded</p>
                                    {% endif %}
                                </div>
                                <h3>{{ database.name }}</h3>
                                <p>{{ database.description }}</p>
                                <p><strong>{{ database.photo_count }} photos</strong></p>
                                <p><strong>Created: {{ database.date_created }}</strong></p>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="no-databases">
                            <i class="fa-solid fa-database"></i>
                            No databases created yet. Create your first database above!
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- The Lightbox Modal -->
        <div id="lightbox" class="lightbox">
            <span class="lightbox-close" id="closeBtn">&times;</span>
            <div class="lightbox-content">
                <a class="lightbox-prev" id="prevBtn">&#10094;</a>
                <img id="lightbox-image" src="" alt="">
                <a class="lightbox-next" id="nextBtn">&#10095;</a>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4>SensiCup</h4>
                    <h5><a href="/">Home</a></h5>
                    <h5><a href="/contact">Contact Us</a></h5>
                </div>
                <div class="footer-section">
                    <h4>Information</h4>
                    <h5><a href="/your-cup">Your Cup</a></h5>
                    <h5><a href="/database">Database</a></h5>
                </div>
            </div>
        </footer>

        <script>
            const uploadArea = document.querySelector('.upload-area');
            const fileInput = document.getElementById('fileInput');
            const uploadedFiles = document.getElementById('uploadedFiles');
            const databaseGrid = document.getElementById('databaseGrid');
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const closeBtn = document.getElementById('closeBtn');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            let currentPhotos = [];
            let currentPhotoIndex = 0;

            // Handle file input change
            fileInput.addEventListener('change', function(e) {
                displayFiles(e.target.files);
            });

            // Handle drag and drop
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                fileInput.files = files;
                displayFiles(files);
            });

            function displayFiles(files) {
                uploadedFiles.innerHTML = '';
                for (let i = 0; i < files.length; i++) {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.textContent = files[i].name;
                    uploadedFiles.appendChild(fileItem);
                }
            }
            
            // Handle opening the lightbox when a database card is clicked
            databaseGrid.addEventListener('click', async function(e) {
                const card = e.target.closest('.database-card');
                if (card) {
                    const databaseId = card.dataset.id;
                    try {
                        const response = await fetch(`/get_photos/${databaseId}`);
                        const photoPaths = await response.json();
                        if (photoPaths.length > 0) {
                            currentPhotos = photoPaths.map(path => `/display_photo/${path}`);
                            currentPhotoIndex = 0;
                            lightbox.style.display = "flex";
                            updateLightboxImage();
                            document.body.style.overflow = 'hidden'; // Prevent background scrolling
                        } else {
                            // Create a modern alert
                            showAlert("This database has no photos to display.", "info");
                        }
                    } catch (error) {
                        console.error('Error fetching photos:', error);
                        showAlert("Error loading photos. Please try again.", "error");
                    }
                }
            });

            // Update the image in the lightbox
            function updateLightboxImage() {
                if (currentPhotos.length > 0) {
                    lightboxImage.src = currentPhotos[currentPhotoIndex];
                }
            }

            // Navigate to the previous image
            prevBtn.addEventListener('click', function() {
                if (currentPhotos.length > 0) {
                    currentPhotoIndex = (currentPhotoIndex - 1 + currentPhotos.length) % currentPhotos.length;
                    updateLightboxImage();
                }
            });

            // Navigate to the next image
            nextBtn.addEventListener('click', function() {
                if (currentPhotos.length > 0) {
                    currentPhotoIndex = (currentPhotoIndex + 1) % currentPhotos.length;
                    updateLightboxImage();
                }
            });

            // Close the lightbox
            closeBtn.addEventListener('click', function() {
                closeLightbox();
            });

            // Close the lightbox by clicking outside the image
            lightbox.addEventListener('click', function(e) {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });

            function closeLightbox() {
                lightbox.style.display = "none";
                document.body.style.overflow = 'auto'; // Re-enable scrolling
            }

            // Add keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (lightbox.style.display === "flex") {
                    if (e.key === "ArrowLeft") {
                        prevBtn.click();
                    } else if (e.key === "ArrowRight") {
                        nextBtn.click();
                    } else if (e.key === "Escape") {
                        closeLightbox();
                    }
                }
            });

            // Modern alert function
            function showAlert(message, type = 'info') {
                const alertDiv = document.createElement('div');
                alertDiv.style.cssText = `
                    position: fixed;
                    top: 100px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${type === 'error' ? 'linear-gradient(135deg, #ff4757, #ff3838)' : 'linear-gradient(135deg, #3282b8, #0f4c75)'};
                    color: white;
                    padding: 1rem 2rem;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 3000;
                    font-weight: 500;
                    backdrop-filter: blur(10px);
                    animation: alertSlideIn 0.3s ease-out;
                `;
                alertDiv.textContent = message;
                
                // Add animation keyframes
                if (!document.querySelector('#alert-styles')) {
                    const style = document.createElement('style');
                    style.id = 'alert-styles';
                    style.textContent = `
                        @keyframes alertSlideIn {
                            from { opacity: 0; transform: translate(-50%, -30px); }
                            to { opacity: 1; transform: translate(-50%, 0); }
                        }
                        @keyframes alertSlideOut {
                            from { opacity: 1; transform: translate(-50%, 0); }
                            to { opacity: 0; transform: translate(-50%, -30px); }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                document.body.appendChild(alertDiv);
                
                setTimeout(() => {
                    alertDiv.style.animation = 'alertSlideOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        document.body.removeChild(alertDiv);
                    }, 300);
                }, 3000);
            }

            // Add loading state to form submission
            document.getElementById('databaseForm').addEventListener('submit', function(e) {
                const submitBtn = this.querySelector('.submit-btn');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Creating...';
                submitBtn.disabled = true;
                
                // Re-enable after 5 seconds in case of error
                setTimeout(() => {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }, 5000);
            });

            // Add subtle animations on scroll
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'fadeInUp 0.8s ease-out forwards';
                    }
                });
            }, observerOptions);

            // Add fadeInUp animation
            if (!document.querySelector('#scroll-animations')) {
                const style = document.createElement('style');
                style.id = 'scroll-animations';
                style.textContent = `
                    @keyframes fadeInUp {
                        from { opacity: 0; transform: translateY(30px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                `;
                document.head.appendChild(style);
            }

            // Observe database cards for scroll animations
            document.querySelectorAll('.database-card').forEach(card => {
                card.style.opacity = '0';
                observer.observe(card);
            });
        </script>
    </body>
</html>